##1.实验思考题
> Thinking 3.1 我们注意到我们把宏函数的函数体写成了 do { // ... } while(0) 的形式，而不是仅仅写成形如 {// ... } 的语句块，这样的写法好处是什么？    

####1、避免引用宏时的出错。    
&emsp;在C语言的代码风格中习惯在每个语句后加上分号，若用将宏写成形如 {// ... } 的语句块，则显然在预编译展开后的代码是有语法错误的，如下:    

	{
		func1();    
	};
而写成了 do { // ... } while(0) 的形式的代码块如果加上分号，在预编译展开后的代码如下:

	do
	{
		func1();
	} while(0);
显然没有语法错误。
####2、可以通过在do { // ... } while(0)代码块中添加`break`语句类似实现`goto`语句的功能。而在简单的{// ... } 的语句块中添加`break`语句将产生错误。    
####3、避免空宏引起的warning。    
 
>Thinking 2.2 了解了二级页表页目录自映射的原理之后，我们知道，Win2k 内核的 虚存管理也是采用了二级页表的形式，其页表所占的4M 空间对应的虚存起始地址 为 0xC0000000，那么，它的页目录的起始地址是多少呢？    

页目录起始地址：0xC0000000+0xC0000000>>10=0xC0300000

>Thinking 2.3 思考一下 tlb_out 汇编函数，结合代码阐述一下跳转到 NOFOUND 的流程？    

具体流程如代码中的注释所述：



	1 #include <asm/regdef.h> 
	2 #include <asm/cp0regdef.h> 
	3 #include <asm/asm.h> 
	4 
	5 LEAF(tlb_out) 
	6 		nop 
	7 		mfc0 k1,CP0_ENTRYHI

	将CP0_ENTRYHI的值保存到k1寄存器中，保存现场 

	8 		mtc0 a0,CP0_ENTRYHI 

	将a0寄存器的值(外部传入的参数)保存到CP0_ENTRYHI寄存器中

	9 		nop 
	10 		tlbp

	tlbp: (tlb prob) 在tlb中查找VPN, ASID都跟EntryHi寄存器中的相应域匹配的入口，并把相应表项的索引值存入index寄存器。如果匹配失败，那么将index的P位（最高为）置1。 

	11 		nop 
	12 		nop 
	13 		nop 
	14 		nop 
	15 		mfc0 k0,CP0_INDEX 

	将CP0_INDEX保存到k0寄存器中

	16 		bltz k0,NOFOUND 

	判断k0的值是否小于0，实际上是判断CP0_INDEX的最高位是否为1，若为1，则可知匹配失败。

	17 		nop 
	18 		mtc0 zero,CP0_ENTRYHI 
	19 		mtc0 zero,CP0_ENTRYLO0 
	20 		nop 
	21 		tlbwi 

	tlbwi: (tlb write by index) 根据index来写tlb表项
	
	22 NOFOUND: 
	23 
	24 		mtc0 k1,CP0_ENTRYHI 

	恢复现场
	25 	
	26 		j ra 

	返回

	27 		nop 
	28 END(tlb_out)
##2.实验难点
&emsp;实验难点在于理清各个函数的作用和联系。
##3.体会与感悟
####难度评价: ★★★★☆(四颗星)    
####实验用时:大约30个小时    
####体会与感悟:
&emsp;相比于lab1，本次实验给人最大的感觉就是凌乱，一大堆不明不白的函数，不知道作用何在，不知道用来干什么的参数、变量，加上本来虚拟内存和物理内存就傻傻分不清，一开始感觉无从下手，我觉得这应该不是我一个人的问题。
##4.指导书反馈
#####1.小错误    
&emsp;在指导书中第53页对于虚拟内存映射布局的讲解中存在小小的错误，即上图中的kseg1，应该是kseg0才对。    
<img src="./1.png">
#####2.大建议
&emsp;不知道是指导书编撰者的本意还是指导书本身的缺陷，我个人觉得指导书虽然讲得还算挺仔细的，但是缺乏一个提纲，说白了我就是希望在每个lab的开头指出我们需要做些什么？通过哪些函数去实现，这个过程涉及到哪些操作，函数中的变量又代表着什么？在宏观上将整个实验的目的讲清楚了，那么剩下的具体代码实现便简单多了。
##5.残留难点
究竟物理内存映射在哪里？分配内存的时候只是分配了sizeof(Page)大小的内存，这跟实际的物理内存貌似是不对应的。